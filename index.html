<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tokyo OS v11</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F9F9F7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Round|Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&family=Lato:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #F9F9F7;
            --card: #FFFFFF;
            --text-main: #1A1A1A;
            --text-sub: #666666;
            --accent: #C5A059; 
            --red: #D9534F;
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body {
            background-color: #EFEFEF;
            margin: 0; padding: 0;
            font-family: 'Lato', 'Noto Serif TC', sans-serif;
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            display: flex; justify-content: center;
            min-height: 100vh;
        }

        #app-container {
            width: 100%; max-width: 430px;
            background-color: var(--bg);
            min-height: 100vh; position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            padding-bottom: calc(90px + var(--safe-bottom));
            overflow-x: hidden;
        }

        /* --- Header & Weather --- */
        header {
            padding: max(20px, env(safe-area-inset-top)) 20px 10px;
            background: var(--bg); position: sticky; top: 0; z-index: 50;
            text-align: center;
        }
        .trip-title { font-size: 1.4rem; font-weight: 700; letter-spacing: 2px; }
        .trip-year { font-size: 0.75rem; border: 1px solid #ccc; border-radius: 20px; padding: 2px 8px; display: inline-block; color: #888; }

        /* Â§©Ê∞£Ê®°ÁµÑ */
        .weather-widget {
            display: flex; gap: 15px; overflow-x: auto; padding: 10px 20px;
            scrollbar-width: none; background: linear-gradient(to bottom, #f9f9f7, #f0f0f0);
            border-bottom: 1px solid #e0e0e0;
        }
        .weather-widget::-webkit-scrollbar { display: none; }
        .w-item { text-align: center; min-width: 50px; }
        .w-time { font-size: 0.7rem; color: #999; }
        .w-icon { font-size: 1.5rem; margin: 2px 0; }
        .w-temp { font-size: 0.9rem; font-weight: 700; font-family: 'Inter'; }

        /* --- Ë°åÁ®ãË°® (Day Scroll) --- */
        .date-scroll {
            display: flex; gap: 10px; overflow-x: auto; padding: 10px 20px;
            scrollbar-width: none;
        }
        .date-scroll::-webkit-scrollbar { display: none; }
        .date-item {
            min-width: 50px; height: 65px; background: #fff; border-radius: 30px;
            border: 1px solid #eee; display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: var(--shadow); transition: 0.2s; cursor: pointer;
        }
        .date-item.active { background: var(--text-main); color: #fff; transform: translateY(-3px); }
        .date-day { font-size: 0.6rem; letter-spacing: 1px; margin-bottom: 2px; }
        .date-num { font-size: 1.2rem; font-weight: 700; font-family: 'Inter'; }

        .timeline-box { padding: 20px; }
        .card {
            background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 20px;
            box-shadow: var(--shadow); position: relative; border: 1px solid rgba(0,0,0,0.03);
            cursor: pointer; transition: 0.2s;
        }
        .card-time { font-family: 'Inter'; font-weight: 600; font-size: 1.1rem; color: var(--accent); margin-bottom: 5px; }
        .card-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .card-sub { font-size: 0.8rem; color: #999; display: flex; align-items: center; gap: 4px;}

        /* --- ÊÜëË≠âÂç°Áâá (Áç®Á´ãÂçÄ) --- */
        .booking-list { padding: 20px; }
        .booking-card {
            background: #fff; border-radius: 12px; overflow: hidden; margin-bottom: 20px;
            box-shadow: var(--shadow); border: 1px solid #eee; position: relative;
        }
        .bk-header { padding: 12px 15px; background: #F8F8F8; border-bottom: 1px dashed #ddd; display: flex; justify-content: space-between; align-items: center; }
        .bk-date { font-size: 0.8rem; font-weight: 700; color: #555; }
        .bk-body { padding: 20px; }
        .bk-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 10px; }
        .bk-code-row { margin-bottom: 15px; }
        .bk-code-label { font-size: 0.7rem; color: #aaa; margin-bottom: 2px; display: block; }
        .bk-code { font-size: 1.4rem; font-family: 'Inter'; font-weight: 700; letter-spacing: 1px; color: var(--text-main); }
        .bk-actions { padding: 12px 15px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .bk-btn {
            flex: 1; text-align: center; font-size: 0.8rem; padding: 8px; border-radius: 6px;
            background: #f0f0f0; color: #333; text-decoration: none; font-weight: 600;
        }
        .btn-del { width: 30px; display: flex; align-items: center; justify-content: center; color: #ffadad; cursor: pointer; }

        /* --- AI Â∞èÁ≤æÈùà (Êá∏ÊµÆÊåâÈàï) --- */
        .ai-fab {
            position: fixed; bottom: 100px; right: 20px;
            width: 50px; height: 50px; background: linear-gradient(135deg, #a18cd1, #fbc2eb);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); cursor: pointer; z-index: 90;
            border: 2px solid #fff;
        }
        .ai-fab span { color: #fff; font-size: 24px; }

        /* --- AI ËÅäÂ§©ÂÆ§ --- */
        .ai-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 3000; display: none;
            justify-content: center; align-items: flex-end;
        }
        .ai-overlay.show { display: flex; }
        .ai-box {
            width: 100%; max-width: 430px; height: 80vh; background: #fff;
            border-radius: 20px 20px 0 0; display: flex; flex-direction: column; overflow: hidden;
        }
        .ai-header { padding: 15px; background: #f5f5f5; font-weight: 700; display: flex; justify-content: space-between; }
        .ai-content { flex: 1; padding: 20px; overflow-y: auto; background: #fff; }
        .msg { margin-bottom: 10px; padding: 10px 15px; border-radius: 15px; max-width: 80%; font-size: 0.9rem; }
        .msg.ai { background: #f0f0f0; align-self: flex-start; margin-right: auto; }
        .msg.user { background: var(--text-main); color: #fff; align-self: flex-end; margin-left: auto; }
        .ai-input-area { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; }

        /* --- Â∫ïÈÉ®Â∞éËà™ & Êñ∞Â¢ûÊåâÈàï --- */
        .nav-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05); padding: 10px 0 calc(10px + var(--safe-bottom));
            display: flex; justify-content: space-around; z-index: 100;
        }
        .nav-item { text-align: center; color: #ccc; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--text-main); }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 2px; }
        .nav-label { font-size: 0.6rem; font-weight: 700; letter-spacing: 1px; }

        /* ‰∏≠ÈñìÊñ∞Â¢ûÊåâÈàï */
        .fab-main {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 60px; background: var(--text-main); border-radius: 50%;
            color: #fff; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 101;
            border: 4px solid #fff;
        }

        /* --- Êñ∞Â¢ûÈù¢Êùø (Sheet) --- */
        .sheet-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 1999; display: none; 
        }
        .sheet-overlay.show { display: block; }
        
        .sheet { 
            width: 100%; max-width: 430px; background: #fff; 
            border-radius: 20px 20px 0 0; padding: 25px; box-sizing: border-box; 
            transform: translateY(100%); transition: 0.3s; 
            padding-bottom: calc(30px + var(--safe-bottom));
            position: fixed; bottom: 0; left: 0; right: 0; margin: 0 auto; 
            z-index: 2000;
        }
        .sheet.show { transform: translateY(0); }
        
        .inp { width: 100%; padding: 14px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 12px; font-size: 1rem; box-sizing: border-box; background: #f9f9f9; }
        .type-row { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px;}
        .type-btn { padding: 8px 16px; border: 1px solid #eee; border-radius: 20px; font-size: 0.9rem; white-space: nowrap; cursor: pointer; }
        .type-btn.active { background: var(--text-main); color: #fff; }
        .btn-main { width: 100%; padding: 15px; background: var(--text-main); color: #fff; border: none; border-radius: 12px; font-weight: 700; font-size: 1rem; cursor: pointer; }

        .view { display: none; }
        .view.active { display: block; }
        
        /* Èö±Ëóè/È°ØÁ§∫ÊéßÂà∂ */
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="app-container">
    
    <header>
        <div class="trip-title">TOKYO TRIP <span class="trip-year">2026</span></div>
    </header>

    <div class="weather-widget" id="weather-box">
        <div style="font-size:0.8rem; color:#999; padding:10px;">ËºâÂÖ•Êù±‰∫¨Â§©Ê∞£...</div>
    </div>

    <div id="view-trip" class="view active">
        <div class="date-scroll" id="date-list">
            </div>
        <div class="timeline-box" id="itinerary-list">
            </div>
    </div>

    <div id="view-booking" class="view">
        <div class="booking-list" id="booking-list">
            </div>
    </div>

    <div id="view-info" class="view">
        <div style="padding:20px; text-align:center;">
            <div style="background:#333; color:#fff; padding:20px; border-radius:12px; margin-bottom:20px;" onclick="window.open('https://www.vjw.digital.go.jp/','_blank')">
                <h3>Visit Japan Web</h3>
                <p style="font-size:0.8rem; opacity:0.7;">ÂÖ•Â¢ÉÂØ©Êü• QR Code</p>
            </div>
            <div style="display:flex; gap:10px;">
                <div style="flex:1; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
                    <div style="color:#d9534f; font-size:2rem; font-weight:bold;">110</div>
                    <div style="font-size:0.7rem; color:#999;">Ë≠¶ÂØü</div>
                </div>
                <div style="flex:1; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
                    <div style="color:#d9534f; font-size:2rem; font-weight:bold;">119</div>
                    <div style="font-size:0.7rem; color:#999;">ÊïëË≠∑</div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-wallet" class="view">
        <div style="text-align:center; padding:30px;">
            <div style="color:#888;">Á∏ΩÊîØÂá∫ (TWD)</div>
            <div style="font-size:2.5rem; font-weight:700;" id="wallet-total">$0</div>
        </div>
        <div id="wallet-list" style="padding:0 20px;"></div>
    </div>

    <div class="ai-fab" onclick="toggleAI(true)">
        <span class="material-icons-round">smart_toy</span>
    </div>

    <div class="ai-overlay" id="ai-modal">
        <div class="ai-box">
            <div class="ai-header">
                <span>Êù±‰∫¨ AI Â∞éÈÅä</span>
                <span class="material-icons-round" onclick="toggleAI(false)">close</span>
            </div>
            <div class="ai-content" id="chat-history">
                <div class="msg ai">Âó®ÔºÅÊÉ≥ÂïèÂ§©Ê∞£„ÄÅ‰∫§ÈÄöÈÇÑÊòØË®Ç‰ΩçÂª∫Ë≠∞Ôºü</div>
            </div>
            <div class="ai-input-area">
                <input type="text" id="ai-input" class="inp" style="margin:0;" placeholder="Ëº∏ÂÖ•ÂïèÈ°å...">
                <button class="btn-main" style="width:auto;" onclick="sendAI()">ÈÄÅÂá∫</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchView('view-trip', this)">
            <span class="material-icons-round nav-icon">map</span>
            <span class="nav-label">Ë°åÁ®ã</span>
        </div>
        <div class="nav-item" onclick="switchView('view-booking', this)">
            <span class="material-icons-round nav-icon">confirmation_number</span>
            <span class="nav-label">ÊÜëË≠â</span>
        </div>
        <div style="width:60px;"></div> <div class="nav-item" onclick="switchView('view-info', this)">
            <span class="material-icons-round nav-icon">info</span>
            <span class="nav-label">Ë≥áË®ä</span>
        </div>
        <div class="nav-item" onclick="switchView('view-wallet', this)">
            <span class="material-icons-round nav-icon">account_balance_wallet</span>
            <span class="nav-label">Ë®òÂ∏≥</span>
        </div>
    </div>

    <div class="fab-main" onclick="openSheet()">
        <span class="material-icons-round" style="font-size:32px;">add</span>
    </div>

    <div class="sheet-overlay" id="sheet-overlay" onclick="closeSheet()"></div>
    <div class="sheet" id="sheet-panel">
        <h3 style="margin-top:0;">Êñ∞Â¢ûÈ†ÖÁõÆ</h3>
        <div class="type-row">
            <div class="type-btn active" onclick="setType('spot', this)">üìç ÊôØÈªû</div>
            <div class="type-btn" onclick="setType('booking', this)">üé´ ÊÜëË≠â/Ë®Ç‰Ωç</div>
            <div class="type-btn" onclick="setType('exp', this)">üí∞ Ë®òÂ∏≥</div>
        </div>

        <div id="form-spot" class="form-group">
            <select id="inp-day" class="inp"></select>
            <input type="time" id="inp-time" class="inp" value="10:00">
            <input type="text" id="inp-title" class="inp" placeholder="Âú∞ÈªûÂêçÁ®±">
            <input type="text" id="inp-desc" class="inp" placeholder="ÂÇôË®ª">
        </div>

        <div id="form-booking" class="form-group hidden">
            <input type="text" id="bk-title" class="inp" placeholder="Ê®ôÈ°å (‰æã: È£ØÂ∫ó„ÄÅÈ§êÂª≥)">
            <input type="text" id="bk-date" class="inp" placeholder="Êó•Êúü (‰æã: 9/13)">
            <input type="text" id="bk-code" class="inp" placeholder="Ë®Ç‰Ωç‰ª£Á¢º / Á¢∫Ë™çËôü">
            <input type="text" id="bk-link" class="inp" placeholder="ÈÄ£ÁµêÁ∂≤ÂùÄ (ÈÅ∏Â°´)">
            <textarea id="bk-note" class="inp" rows="2" placeholder="ÂÇôË®ª (ÈÅ∏Â°´)"></textarea>
        </div>

        <div id="form-exp" class="form-group hidden">
            <input type="number" id="exp-amt" class="inp" placeholder="ÈáëÈ°ç (JPY)">
            <input type="text" id="exp-item" class="inp" placeholder="Ê∂àË≤ªÈ†ÖÁõÆ">
        </div>

        <button class="btn-main" onclick="saveItem()">ÂÑ≤Â≠ò</button>
    </div>

</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCbrzyXFiRYxGyt6crsRTQNQ5lfZnz65kA",
        authDomain: "tokyo-trip-2026-acfe6.firebaseapp.com",
        databaseURL: "https://tokyo-trip-2026-acfe6-default-rtdb.firebaseio.com",
        projectId: "tokyo-trip-2026-acfe6",
        storageBucket: "tokyo-trip-2026-acfe6.firebasestorage.app",
        messagingSenderId: "345730464055",
        appId: "1:345730464055:web:662b4c0391f893828c42b2",
        measurementId: "G-FKTG3ERB29"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentDay = 1;
    let currentType = 'spot';

    init();

    function init() {
        const dateList = document.getElementById('date-list');
        const daySel = document.getElementById('inp-day');
        for(let i=1; i<=10; i++) {
            dateList.innerHTML += `<div class="date-item ${i===1?'active':''}" onclick="setDay(${i}, this)">
                <span class="date-day">DAY</span><span class="date-num">${i}</span>
            </div>`;
            daySel.innerHTML += `<option value="${i}">Day ${i}</option>`;
        }
        loadData();
        loadWeather();
    }

    async function loadWeather() {
        const box = document.getElementById('weather-box');
        try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=35.6895&longitude=139.6917&hourly=weathercode,temperature_2m&timezone=Asia%2FTokyo&forecast_days=1');
            const data = await res.json();
            box.innerHTML = '';
            for(let i=9; i<21; i+=3) { // È°ØÁ§∫ÁôΩÂ§©ÁöÑÂ§©Ê∞£
                const t = data.hourly.time[i].split('T')[1];
                const temp = Math.round(data.hourly.temperature_2m[i]);
                const code = data.hourly.weathercode[i];
                let icon = code<=3 ? '‚òÄÔ∏è' : (code<=48 ? '‚òÅÔ∏è' : 'üåßÔ∏è');
                box.innerHTML += `<div class="w-item"><div class="w-time">${t}</div><div class="w-icon">${icon}</div><div class="w-temp">${temp}¬∞</div></div>`;
            }
        } catch(e) { box.innerHTML = '<span style="padding:10px; color:#999;">Â§©Ê∞£ËºâÂÖ•Â§±Êïó</span>'; }
    }

    function setDay(d, el) {
        currentDay = d;
        document.querySelectorAll('.date-item').forEach(e=>e.classList.remove('active'));
        el.classList.add('active');
        loadData();
    }

    function loadData() {
        // 1. Ë°åÁ®ã
        db.ref('schedule').on('value', snap => {
            const list = document.getElementById('itinerary-list');
            list.innerHTML = '';
            const data = snap.val();
            if(data) {
                let arr = [];
                for(let k in data) arr.push({id:k, ...data[k]});
                arr.sort((a,b) => a.time.localeCompare(b.time));
                arr.forEach(item => {
                    if(item.day == currentDay) {
                        list.innerHTML += `
                        <div class="card">
                            <div class="card-time">${item.time}</div>
                            <div class="card-title">${item.title}</div>
                            <div class="card-sub">${item.desc || ''}</div>
                            <span onclick="delItem('schedule','${item.id}')" style="position:absolute; top:15px; right:15px; color:#ffadad; cursor:pointer;">√ó</span>
                        </div>`;
                    }
                });
            }
        });

        // 2. ÊÜëË≠â (Bookings) - Áç®Á´ãË∑ØÂæë
        db.ref('bookings').on('value', snap => {
            const list = document.getElementById('booking-list');
            list.innerHTML = '';
            const data = snap.val();
            if(data) {
                Object.entries(data).forEach(([key, item]) => {
                    let linkHtml = item.link ? `<a href="${item.link}" target="_blank" class="bk-btn">ÈñãÂïüÈÄ£Áµê</a>` : '';
                    list.innerHTML += `
                    <div class="booking-card">
                        <div class="bk-header">
                            <span class="bk-date">${item.date}</span>
                            <span class="btn-del" onclick="delItem('bookings','${key}')"><span class="material-icons-round">delete</span></span>
                        </div>
                        <div class="bk-body">
                            <div class="bk-title">${item.title}</div>
                            <div class="bk-code-row">
                                <span class="bk-code-label">Á¢∫Ë™ç‰ª£Á¢º / ÂÇôË®ª</span>
                                <div class="bk-code">${item.code || item.note || '--'}</div>
                            </div>
                        </div>
                        <div class="bk-actions">
                            ${linkHtml}
                        </div>
                    </div>`;
                });
            } else {
                list.innerHTML = '<div style="text-align:center; padding:30px; color:#999;">Â∞öÁÑ°ÊÜëË≠âÔºåË´ãÊåâ + Êñ∞Â¢û</div>';
            }
        });

        // 3. Ë®òÂ∏≥
        db.ref('expenses').on('value', snap => {
            const list = document.getElementById('wallet-list');
            list.innerHTML = ''; let total = 0;
            const data = snap.val();
            if(data) {
                Object.values(data).forEach(ex => {
                    const twd = Math.round(ex.amount * 0.22);
                    total += twd;
                    list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:15px 0; border-bottom:1px solid #eee;"><span>${ex.item}</span><span style="font-weight:700;">$${twd}</span></div>`;
                });
            }
            document.getElementById('wallet-total').innerText = '$'+total.toLocaleString();
        });
    }

    function delItem(path, id) { if(confirm('Á¢∫ÂÆöÂà™Èô§?')) db.ref(path+'/'+id).remove(); }

    // --- UI ÊéßÂà∂ ---
    function switchView(id, el) {
        document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
        el.classList.add('active');
    }
    
    function openSheet() { 
        // Â¶ÇÊûúÁï∂ÂâçÂú®ÊÜëË≠âÈ†ÅÔºåÈ†êË®≠ÈÅ∏ Booking
        if(document.getElementById('view-booking').classList.contains('active')) {
            const bookingBtn = document.querySelectorAll('.type-btn')[1]; // ÂÅáË®≠ÊòØÁ¨¨‰∫åÂÄã
            setType('booking', bookingBtn);
        }
        document.getElementById('sheet-overlay').classList.add('show'); 
        document.getElementById('sheet-panel').classList.add('show'); 
    }
    function closeSheet() { document.getElementById('sheet-overlay').classList.remove('show'); document.getElementById('sheet-panel').classList.remove('show'); }

    function setType(t, el) {
        currentType = t;
        document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active'));
        if(el) el.classList.add('active');
        
        // Èö±ËóèÊâÄÊúâË°®ÂñÆ
        document.getElementById('form-spot').classList.add('hidden');
        document.getElementById('form-booking').classList.add('hidden');
        document.getElementById('form-exp').classList.add('hidden');

        // È°ØÁ§∫Â∞çÊáâË°®ÂñÆ
        if(t === 'booking') document.getElementById('form-booking').classList.remove('hidden');
        else if(t === 'exp') document.getElementById('form-exp').classList.remove('hidden');
        else document.getElementById('form-spot').classList.remove('hidden');
    }

    function saveItem() {
        if(currentType === 'booking') {
            const title = document.getElementById('bk-title').value;
            if(!title) return alert('Ë´ãËº∏ÂÖ•Ê®ôÈ°å');
            db.ref('bookings').push({
                title: title,
                date: document.getElementById('bk-date').value,
                code: document.getElementById('bk-code').value,
                link: document.getElementById('bk-link').value,
                note: document.getElementById('bk-note').value
            });
        } else if(currentType === 'exp') {
            db.ref('expenses').push({
                amount: document.getElementById('exp-amt').value,
                item: document.getElementById('exp-item').value
            });
        } else {
            db.ref('schedule').push({
                day: document.getElementById('inp-day').value,
                time: document.getElementById('inp-time').value,
                title: document.getElementById('inp-title').value,
                desc: document.getElementById('inp-desc').value,
                type: currentType
            });
        }
        closeSheet();
        // Ê∏ÖÁ©∫ (Áï•)
    }

    // AI
    function toggleAI(show) { 
        const el = document.getElementById('ai-modal');
        if(show) el.classList.add('show'); else el.classList.remove('show');
    }
    function sendAI() {
        const inp = document.getElementById('ai-input');
        const box = document.getElementById('chat-history');
        if(!inp.value) return;
        box.innerHTML += `<div class="msg user">${inp.value}</div>`;
        setTimeout(()=>{
            box.innerHTML += `<div class="msg ai">ÈÄôÂÄãÂïèÈ°åÊàë‰πüÊÉ≥Áü•ÈÅìÔºÅ(Ê®°Êì¨ÂõûË¶Ü)</div>`;
            box.scrollTop = box.scrollHeight;
        }, 800);
        inp.value='';
    }

    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
</script>
</body>
</html>